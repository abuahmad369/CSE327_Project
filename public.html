<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CampusCast - ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</title>
  <link rel="stylesheet" href="./assets/style.css" />
</head>
<body>
  <div class="hands-bg"></div>

  <div class="container">
    <!-- Header same style as login/reg -->
    <header class="site-header">
      <a href="./index.html" class="logo" aria-label="CampusCast ‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú‡ßá ‡¶Ø‡¶æ‡¶®">
        <div class="logo-text">
          <span>CampusCast</span>
          <div class="logo-bars">
            <div class="bar"></div>
            <div class="bar alt"></div>
            <div class="bar"></div>
            <div class="bar alt"></div>
          </div>
        </div>
        <div class="logo-subtitle">‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü ‡¶á ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</div>
      </a>

   <nav class="site-nav">
        <a href="/login/login.html" class="nav-link">‡¶™‡ßç‡¶∞‡¶∂‡¶æ‡¶∏‡¶ï</a>
        <a href="/login/login.html" class="nav-link">‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ</a>
        <a href="/login/login.html" class="nav-link">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞</a>
        <a href="public.html" class="nav-link">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï</a>
         <!-- <a href="/dashboard-test.html" class="nav-link">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a> -->
        <a class="login-btn" href="/login/login.html" role="button">‡¶≤‡¶ó‡¶á‡¶®</a>
      </nav>
    </header>

    <main class="main-content" style="gap:40px; align-items:flex-start;">
      <!-- Left info column -->
      <section class="content" style="max-width:460px;">
        <span class="badge">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶≠‡¶ø‡¶â</span>
        <h1>‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶ì ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h1>
        <p class="description">
          ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßã‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá ‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßÄ‡¶ï/‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®
          ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶§‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶≠‡ßã‡¶ü ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶® ‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§
        </p>

        <div class="ethereum-note" style="margin-top:12px;">
          <span class="ethereum-icon">üìä</span>
          ‡¶§‡¶•‡ßç‡¶Ø‡¶ó‡ßÅ‡¶≤‡¶ø Supabase ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡•§
        </div>
      </section>

      <!-- Right results column -->
      <section aria-label="‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶´‡¶≤‡¶æ‡¶´‡¶≤" style="flex:1; max-width:540px;">
        <div style="
          background:#fff;
          border:1px solid var(--border);
          border-radius:14px;
          box-shadow:0 6px 18px rgba(0,0,0,.08);
          padding:22px;
        ">
          <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:16px;">
            <div>
              <h2 style="margin:0 0 6px; font-size:20px; font-weight:800; color:var(--ink);">
                ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶ì ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂
              </h2>
              <p style="margin:0; font-size:14px; color:#4b5563;">
                ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶§‡ßÄ‡¶ï, ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§
              </p>
            </div>

            <!-- Filters -->
            <div style="display:flex; flex-direction:column; gap:6px; align-items:flex-end;">
              <select
                id="electionFilter"
                style="
                  padding:6px 10px;
                  border-radius:999px;
                  border:1px solid var(--border);
                  font-size:13px;
                "
              >
                <option value="all">‡¶∏‡¶¨ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</option>
              </select>

              <input
                type="text"
                id="searchInput"
                placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®"
                style="
                  padding:6px 10px;
                  border-radius:999px;
                  border:1px solid var(--border);
                  font-size:13px;
                "
              />
            </div>
          </div>

          <div id="publicStatus" style="margin-top:10px; font-size:14px; color:#4b5563;">
            ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...
          </div>

          <div id="resultsContainer" style="margin-top:14px; display:flex; flex-direction:column; gap:10px;">
            <!-- Cards injected by JS -->
          </div>
        </div>
      </section>
    </main>

    <footer class="features">
      <div class="feature">
        <div class="feature-icon">üßæ</div>
        <div class="feature-text">
          <h3>‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ</h3>
          <p>‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶ì ‡¶®‡¶ø‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡•§</p>
        </div>
      </div>
      <div class="feature">
        <div class="feature-icon">üîí</div>
        <div class="feature-text">
          <h3>‡¶è‡¶®‡ßç‡¶° ‡¶ü‡ßÅ ‡¶è‡¶®‡ßç‡¶° ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</h3>
          <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ß‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡ßá‡•§</p>
        </div>
      </div>
      <div class="feature">
        <div class="feature-icon">‚ö°</div>
        <div class="feature-text">
          <h3>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ì ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞</h3>
          <p>‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
        </div>
      </div>

      <div class="footer-credit">
        <p>¬© ‡ß®‡ß¶‡ß®‡ß´ <strong>FourA</strong> - CampusCast</p>
      </div>
    </footer>
  </div>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <script>
    /**
     * Supabase configuration for public read access.
     * Must match your project settings.
     * @type {string}
     */
    const SUPABASE_URL = "https://hgxjuxgxgbjjqxxvafhx.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_RqoNSHsQQOhs8dfL0OXsdA_TfeVyZcn";

    /**
     * Supabase client instance.
     * @type {import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js').SupabaseClient}
     */
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    /**
     * Raw candidate row with joined election and user.
     * Matches your candidates schema plus extra columns.
     *
     * @typedef {Object} CandidateRow
     * @property {string} id
     * @property {string} user_id
     * @property {string|null} election_id
     * @property {string|null} manifesto
     * @property {string|null} symbol
     * @property {string|null} requested_symbol
     * @property {string|null} approved_symbol
     * @property {boolean} is_approved
     * @property {"draft"|"submitted"|"under_review"|"approved"|"rejected"} status
     * @property {Object|null} user
     * @property {string} [user.name]
     * @property {string} [user.email]
     * @property {string|null} [user.dept]
     * @property {Object|null} election
     * @property {string} [election.id]
     * @property {string} [election.title]
     * @property {string|null} [election.status]
     */

    /**
     * Vote row subset.
     *
     * @typedef {Object} VoteRow
     * @property {string} candidate_id
     * @property {string} election_id
     */

    /**
     * Aggregated public view for one candidate in one election.
     *
     * @typedef {Object} PublicResult
     * @property {string} candidateId
     * @property {string} candidateName
     * @property {string} candidateEmail
     * @property {string|null} candidateDept
     * @property {string} electionId
     * @property {string} electionTitle
     * @property {string|null} electionStatus
     * @property {string} symbol
     * @property {number} votes
     * @property {number} voteSharePercent
     */

    /**
     * Cached list of results.
     * @type {PublicResult[]}
     */
    let publicResults = [];

    /**
     * Fetch approved candidates with their election and user info.
     *
     * @returns {Promise<CandidateRow[]>}
     */
    async function fetchApprovedCandidates() {
      const { data, error } = await supabase
        .from("candidates")
        .select(`
          id,
          user_id,
          election_id,
          manifesto,
          symbol,
          requested_symbol,
          approved_symbol,
          is_approved,
          status,
          user:user_id (
            name,
            email,
            dept
          ),
          election:election_id (
            id,
            title,
            status
          )
        `)
        .eq("is_approved", true);

      if (error) {
        console.error("Error fetching candidates:", error);
        throw new Error("‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
      }

      return data || [];
    }

    /**
     * Fetch all votes (candidate and election ids only).
     *
     * @returns {Promise<VoteRow[]>}
     */
    async function fetchVotes() {
      const { data, error } = await supabase
        .from("votes")
        .select("candidate_id, election_id");

      if (error) {
        console.error("Error fetching votes:", error);
        throw new Error("‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
      }

      return data || [];
    }

    /**
     * Build aggregated public results from candidates and votes.
     *
     * @param {CandidateRow[]} candidates
     * @param {VoteRow[]} votes
     * @returns {PublicResult[]}
     */
    function buildPublicResults(candidates, votes) {
      /** @type {Record<string, number>} */
      const candidateVoteCount = {};
      /** @type {Record<string, number>} */
      const electionTotals = {};

      // Count votes per candidate and per election
      votes.forEach((vote) => {
        const cKey = vote.candidate_id;
        const eKey = vote.election_id;

        candidateVoteCount[cKey] = (candidateVoteCount[cKey] || 0) + 1;
        electionTotals[eKey] = (electionTotals[eKey] || 0) + 1;
      });

      /** @type {PublicResult[]} */
      const results = [];

      candidates.forEach((c) => {
        if (!c.election || !c.election.id) {
          return;
        }

        const electionId = c.election.id;
        const totalInElection = electionTotals[electionId] || 0;
        const votesForCandidate = candidateVoteCount[c.id] || 0;
        const share =
          totalInElection > 0 ? (votesForCandidate / totalInElection) * 100 : 0;

        const symbol =
          c.approved_symbol ||
          c.requested_symbol ||
          c.symbol ||
          "‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Ø‡¶º";

        results.push({
          candidateId: c.id,
          candidateName: c.user?.name || "‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ",
          candidateEmail: c.user?.email || "",
          candidateDept: c.user?.dept || null,
          electionId,
          electionTitle: c.election.title || "‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á",
          electionStatus: c.election.status || null,
          symbol,
          votes: votesForCandidate,
          voteSharePercent: Math.round(share * 10) / 10 // one decimal
        });
      });

      // sort by election then votes desc
      results.sort((a, b) => {
        if (a.electionTitle < b.electionTitle) return -1;
        if (a.electionTitle > b.electionTitle) return 1;
        return b.votes - a.votes;
      });

      return results;
    }

    /**
     * Populate election filter options using current results.
     *
     * @returns {void}
     */
    function populateElectionFilter() {
      const select = /** @type {HTMLSelectElement} */ (
        document.getElementById("electionFilter")
      );
      if (!select) return;

      // clear and add "all"
      select.innerHTML = "";
      const allOpt = document.createElement("option");
      allOpt.value = "all";
      allOpt.textContent = "‡¶∏‡¶¨ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®";
      select.appendChild(allOpt);

      /** @type {Set<string>} */
      const seen = new Set();

      publicResults.forEach((r) => {
        if (seen.has(r.electionId)) return;
        seen.add(r.electionId);

        const opt = document.createElement("option");
        opt.value = r.electionId;
        const statusLabel =
          r.electionStatus === "active"
            ? "‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®"
            : r.electionStatus === "closed"
            ? "‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§"
            : r.electionStatus || "";
        opt.textContent = statusLabel
          ? `${r.electionTitle} (${statusLabel})`
          : r.electionTitle;
        select.appendChild(opt);
      });
    }

    /**
     * Render results based on filters.
     *
     * @returns {void}
     */
    function renderResults() {
      const container = document.getElementById("resultsContainer");
      const status = document.getElementById("publicStatus");
      const electionFilter = /** @type {HTMLSelectElement} */ (
        document.getElementById("electionFilter")
      );
      const searchInput = /** @type {HTMLInputElement} */ (
        document.getElementById("searchInput")
      );

      if (!container || !status || !electionFilter || !searchInput) return;

      container.innerHTML = "";

      if (!publicResults.length) {
        status.textContent =
          "‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶¨‡¶æ ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";
        return;
      }

      const selectedElection = electionFilter.value;
      const search = searchInput.value.trim().toLowerCase();

      const filtered = publicResults.filter((r) => {
        if (selectedElection !== "all" && r.electionId !== selectedElection) {
          return false;
        }
        if (search) {
          const name = r.candidateName.toLowerCase();
          const email = r.candidateEmail.toLowerCase();
          if (!name.includes(search) && !email.includes(search)) {
            return false;
          }
        }
        return true;
      });

      if (!filtered.length) {
        status.textContent = "‡¶è‡¶á ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";
        return;
      }

      status.textContent = `‡¶Æ‡ßã‡¶ü ${filtered.length} ‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§`;

      filtered.forEach((r) => {
        const card = document.createElement("div");
        card.style.border = "1px solid var(--border)";
        card.style.borderRadius = "12px";
        card.style.padding = "12px 14px";
        card.style.backgroundColor = "#f9fafb";

        const header = document.createElement("div");
        header.style.display = "flex";
        header.style.justifyContent = "space-between";
        header.style.alignItems = "flex-start";
        header.style.marginBottom = "4px";

        const left = document.createElement("div");
        const nameP = document.createElement("p");
        nameP.style.margin = "0 0 2px";
        nameP.style.fontWeight = "700";
        nameP.textContent = r.candidateName;

        const subP = document.createElement("p");
        subP.style.margin = "0";
        subP.style.fontSize = "13px";
        subP.style.color = "#4b5563";
        const dept = r.candidateDept ? " ¬∑ " + r.candidateDept : "";
        subP.textContent = (r.candidateEmail || "no-email") + dept;

        left.appendChild(nameP);
        left.appendChild(subP);

        const symbolTag = document.createElement("span");
        symbolTag.textContent = r.symbol;
        symbolTag.style.fontSize = "12px";
        symbolTag.style.fontWeight = "600";
        symbolTag.style.padding = "4px 10px";
        symbolTag.style.borderRadius = "999px";
        symbolTag.style.backgroundColor = "#e0f2fe";
        symbolTag.style.color = "#0369a1";

        header.appendChild(left);
        header.appendChild(symbolTag);
        card.appendChild(header);

        const electionP = document.createElement("p");
        electionP.style.margin = "2px 0 4px";
        electionP.style.fontSize = "13px";
        const statusLabel =
          r.electionStatus === "active"
            ? "‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®"
            : r.electionStatus === "closed"
            ? "‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§"
            : r.electionStatus || "";
        electionP.innerHTML =
          "<strong>‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®:</strong> " +
          (statusLabel ? `${r.electionTitle} (${statusLabel})` : r.electionTitle);
        card.appendChild(electionP);

        const votesP = document.createElement("p");
        votesP.style.margin = "0";
        votesP.style.fontSize = "13px";
        votesP.innerHTML =
          "<strong>‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü:</strong> " +
          r.votes +
          ` (${r.voteSharePercent.toFixed(1)}%)`;
        card.appendChild(votesP);

        container.appendChild(card);
      });
    }

    /**
     * Initialize public results page:
     *  - fetch candidates and votes
     *  - build aggregates
     *  - setup filters
     *
     * @returns {Promise<void>}
     */
    async function initPublicPage() {
      const status = document.getElementById("publicStatus");
      if (status) {
        status.textContent = "‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
      }

      try {
        const [candidates, votes] = await Promise.all([
          fetchApprovedCandidates(),
          fetchVotes()
        ]);

        publicResults = buildPublicResults(candidates, votes);
        populateElectionFilter();

        const electionFilter = document.getElementById("electionFilter");
        const searchInput = document.getElementById("searchInput");

        if (electionFilter) {
          electionFilter.addEventListener("change", renderResults);
        }
        if (searchInput) {
          searchInput.addEventListener("input", renderResults);
        }

        renderResults();
      } catch (err) {
        console.error(err);
        if (status) {
          status.textContent =
            err && err.message
              ? err.message
              : "‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§";
          status.style.color = "crimson";
        }
      }
    }

    // Run on load
    initPublicPage();
  </script>
</body>
</html>
