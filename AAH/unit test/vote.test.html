<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>CampusCast - Voter Dashboard Tests</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mocha/mocha.css" />
</head>
<body>
  <h1>CampusCast - ভোটার ড্যাশবোর্ড Unit Tests</h1>
  <div id="mocha"></div>

  <!-- Load Mocha & Chai FIRST -->
  <script src="https://cdn.jsdelivr.net/npm/mocha/mocha.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chai/chai.js"></script>

  <script>
    // Ensure chai is fully loaded
    const waitForExpect = setInterval(() => {
      if (window.chai && chai.expect) {
        window.expect = chai.expect; // make global
        clearInterval(waitForExpect);
        mocha.setup("bdd");
        runTests(); // start tests only when expect is ready
      }
    }, 10);

    function runTests() {
      // Create hidden iframe
      const iframe = document.createElement("iframe");
      iframe.id = "appFrame";
      iframe.src = "voter.html";
      iframe.style = "width:0;height:0;border:0;visibility:hidden;";
      document.body.appendChild(iframe);

      describe("CampusCast Voter Dashboard UI", function () {
        let doc;

        before(function (done) {
          iframe.onload = function () {
            doc = iframe.contentDocument || iframe.contentWindow.document;
            done();
          };
        });

        it("পেইজের title সঠিক আছে", function () {
          expect(doc.title).to.equal("CampusCast - ভোটার ড্যাশবোর্ড");
        });

        it("হেডারে logo লিংক index.html এ যায়", function () {
          const logoLink = doc.querySelector(".site-header .logo");
          expect(logoLink).to.exist;
          expect(logoLink.getAttribute("href")).to.equal("index.html");
        });

        it("নেভিগেশন মেনু ঠিকভাবে আছে", function () {
          const navLinks = Array.from(doc.querySelectorAll(".site-nav .nav-link"));
          expect(navLinks.length).to.be.at.least(4);
        });

        it("লগইন বাটন সঠিক আছে", function () {
          const loginBtn = doc.querySelector(".site-nav .login-btn");
          expect(loginBtn).to.exist;
          expect(loginBtn.getAttribute("href")).to.equal("/login/login.html");
        });

        it("welcome title আছে", function () {
          expect(doc.getElementById("welcomeTitle")).to.exist;
          expect(doc.getElementById("voterName")).to.exist;
        });

        it("vote history ও profile বাটন আছে", function () {
          const buttons = Array.from(doc.querySelectorAll(".button-group .btn"));
          const hrefs = buttons.map(b => b.getAttribute("href"));
          expect(hrefs).to.include("vote-history.html");
          expect(hrefs).to.include("voter-profile.html");
        });

        it("elections container আছে", function () {
          expect(doc.getElementById("electionsContainer")).to.exist;
        });

        it("logout বাটন আছে", function () {
          const btn = doc.getElementById("logoutBtn");
          expect(btn).to.exist;
        });

        it("footer এ তিনটা feature ব্লক আছে", function () {
          const features = doc.querySelectorAll("footer.features .feature");
          expect(features.length).to.equal(3);
        });

        it("footer dot indicators আছে", function () {
          const dots = doc.querySelectorAll("footer .dots .dot");
          expect(dots.length).to.be.at.least(1);
        });
      });

      mocha.run();
    }
  </script>
</body>
</html>
