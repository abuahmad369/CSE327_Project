<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CampusCast - ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</title>
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <!-- background image -->
  <div class="hands-bg"></div>

  <div class="container">
    <!-- Header (same as login) -->
    <header class="site-header">
      <a href="/index.html" class="logo" aria-label="CampusCast ‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú‡ßá ‡¶Ø‡¶æ‡¶®">
        <div class="logo-text">
          <span>CampusCast</span>
          <div class="logo-bars">
            <div class="bar"></div>
            <div class="bar alt"></div>
            <div class="bar"></div>
            <div class="bar alt"></div>
          </div>
        </div>
        <div class="logo-subtitle">‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü ‡¶á ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</div>
      </a>

      <nav class="site-nav">
        <a href="/login/login.html" class="nav-link">‡¶™‡ßç‡¶∞‡¶∂‡¶æ‡¶∏‡¶ï</a>
        <a href="/login/login.html" class="nav-link">‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ</a>
        <a href="/login/login.html" class="nav-link">‡¶≠‡ßã‡¶ü‡¶æ‡¶∞</a>
        <a href="/public.html" class="nav-link">‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï</a>
        <a class="login-btn" href="/login/login.html" role="button">‡¶≤‡¶ó‡¶á‡¶®</a>
      </nav>
    </header>

    <!-- Main content (aligned with login layout) -->
    <main class="main-content" style="gap:40px; align-items:flex-start;">
      <!-- Left description -->
      <section class="content" style="max-width:520px;">
        <span class="badge">‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</span>
        <h1>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶≠‡ßã‡¶ü‡¶∏‡¶Æ‡ßÇ‡¶π</h1>
        <p class="description">
          ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡ßü‡•§
          ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶≠‡ßã‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡ßü‡•§
        </p>

        <div class="ethereum-note" style="margin-top:12px;">
          <span class="ethereum-icon">‚ÑπÔ∏è</span>
          ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶á ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ Supabase ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá
          ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶Ü‡¶∏‡¶≤ ‡¶≠‡ßã‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§
        </div>
      </section>

      <!-- Right history card (styled like login card) -->
      <section aria-label="‡¶≠‡ßã‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ" style="flex:1; max-width:540px;">
        <div
          style="
            background:#fff;
            border:1px solid var(--border);
            border-radius:14px;
            box-shadow:0 6px 18px rgba(0,0,0,.08);
            padding:22px;
          "
        >
          <h2 style="margin:0 0 8px; font-size:20px; font-weight:800; color:var(--ink);">
            ‡¶≠‡ßã‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°
          </h2>

          <p id="historyStatus" style="margin:0 0 12px; font-size:13px; color:#4b5563;">
            ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶
          </p>

          <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; font-size:14px;">
              <thead>
                <tr style="background:#f3f4f6;">
                  <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">
                    ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®
                  </th>
                  <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">
                    ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ
                  </th>
                  <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">
                    ‡¶∏‡¶Æ‡ßü
                  </th>
                </tr>
              </thead>
              <tbody id="historyBody">
                <!-- rows injected by JS -->
              </tbody>
            </table>
          </div>

          <button
            class="btn btn-secondary"
            type="button"
            style="margin-top:16px; width:100%; text-align:center;"
            onclick="window.location.href='voter.html';"
          >
            ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
          </button>
        </div>
      </section>
    </main>

    <!-- Footer (same style as login) -->
    <footer class="features">
      <div class="feature">
        <div class="feature-icon">üßæ</div>
        <div class="feature-text">
          <h3>‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ</h3>
          <p>‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶ì ‡¶®‡¶ø‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡•§</p>
        </div>
      </div>
      <div class="feature">
        <div class="feature-icon">üîí</div>
        <div class="feature-text">
          <h3>‡¶è‡¶®‡ßç‡¶° ‡¶ü‡ßÅ ‡¶è‡¶®‡ßç‡¶° ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</h3>
          <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ß‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡ßá‡•§</p>
        </div>
      </div>
      <div class="feature">
        <div class="feature-icon">‚ö°</div>
        <div class="feature-text">
          <h3>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ì ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞</h3>
          <p>‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
        </div>
      </div>

      <div class="nav-arrows">
        <button class="arrow-btn" aria-label="‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°">‚Äπ</button>
        <button class="arrow-btn" aria-label="‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°">‚Ä∫</button>
      </div>

      <div class="dots" aria-hidden="true">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>

      <div class="footer-credit">
        <p>¬© ‡ß®‡ß¶‡ß®‡ß´ <strong>FourA</strong> - CampusCast</p>
      </div>
    </footer>
  </div>

  <!-- JS: current voter + local history -->
  <script>
    const CC_CURRENT_USER_KEY = "cc_currentUser";
    const CC_VOTE_HISTORY_KEY = "cc_voteHistory";

    function getCurrentUser() {
      try {
        const raw = localStorage.getItem(CC_CURRENT_USER_KEY);
        return raw ? JSON.parse(raw) : null;
      } catch {
        return null;
      }
    }

    function ensureVoterUser() {
      const user = getCurrentUser();
      if (!user) {
        window.location.href = "/login/login.html";
        return null;
      }
      if (user.role !== "voter") {
        alert("‡¶è‡¶á ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§");
        window.location.href = "/login/login.html";
        return null;
      }
      return user;
    }

    function loadHistory(user) {
      try {
        const raw = localStorage.getItem(CC_VOTE_HISTORY_KEY) || "[]";
        const list = JSON.parse(raw);
        // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
        return list.filter(entry => entry.userId === user.id);
      } catch (e) {
        console.warn("vote history ‡¶™‡ßú‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", e);
        return [];
      }
    }

    function formatTime(iso) {
      if (!iso) return "";
      const d = new Date(iso);
      if (Number.isNaN(d.getTime())) return iso;
      return d.toLocaleString("bn-BD");
    }

    (function initHistoryPage() {
      const user = ensureVoterUser();
      if (!user) return;

      const statusEl = document.getElementById("historyStatus");
      const bodyEl = document.getElementById("historyBody");
      if (!statusEl || !bodyEl) return;

      const rows = loadHistory(user);

      if (!rows.length) {
        statusEl.textContent =
          "‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡ßã‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶≤‡ßá ‡¶è‡¶á ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá‡•§";
        bodyEl.innerHTML = "";
        return;
      }

      // newest first
      rows.sort((a, b) => (a.timestamp < b.timestamp ? 1 : -1));

      statusEl.textContent = `‡¶Æ‡ßã‡¶ü ${rows.length} ‡¶ü‡¶ø ‡¶≠‡ßã‡¶ü ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§`;

      bodyEl.innerHTML = "";
      rows.forEach(r => {
        const tr = document.createElement("tr");

        const tdElection = document.createElement("td");
        tdElection.style.padding = "6px 8px";
        tdElection.style.borderBottom = "1px solid var(--border)";
        tdElection.textContent = r.electionTitle || r.electionId;

        const tdCandidate = document.createElement("td");
        tdCandidate.style.padding = "6px 8px";
        tdCandidate.style.borderBottom = "1px solid var(--border)";
        tdCandidate.textContent = r.candidateName || r.candidateId;

        const tdTime = document.createElement("td");
        tdTime.style.padding = "6px 8px";
        tdTime.style.borderBottom = "1px solid var(--border)";
        tdTime.textContent = formatTime(r.timestamp);

        tr.appendChild(tdElection);
        tr.appendChild(tdCandidate);
        tr.appendChild(tdTime);
        bodyEl.appendChild(tr);
      });
    })();
  </script>
</body>
</html>
