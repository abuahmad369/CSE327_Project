<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registered Candidates | CampusCast</title>
  <link rel="stylesheet" href="../assets/style.css" />
  <style>
    /* Reuse exact styling from registervoters.html */
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f2027, #2c5364, #00c97f);
      color: #fff;
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: rgba(0, 0, 0, 0.35);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      backdrop-filter: blur(8px);
    }

    header h1 {
      font-size: 1.6rem;
      color: #00ffae;
    }

    nav a, nav button {
      color: white;
      text-decoration: none;
      margin-left: 1rem;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.3s;
      font-size: 1rem;
      font-weight: 500;
    }

    nav a:hover, nav button:hover {
      color: #00ffae;
    }

    main {
      flex: 1;
      padding: 2rem;
    }

    h2 {
      color: #00ffae;
      margin-bottom: 1.2rem;
    }

    /* Search & Filter */
    .filter-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 0.8rem;
    }

    .filter-bar input, .filter-bar select {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 0.5rem 1rem;
      outline: none;
    }

    .filter-bar input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 0.9rem 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    }

    th {
      background: rgba(255, 255, 255, 0.15);
      color: #00ffae;
      font-weight: 600;
      font-size: 1rem;
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .role-badge {
      background: #00c97f;
      color: #000;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.8rem;
    }
    
    footer {
      text-align: center;
      background: rgba(0, 0, 0, 0.35);
      padding: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>üï¥Ô∏è Registered Candidates (‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ)</h1>
    <nav>
      <a href="../index.html">üè† Home</a>
      <a href="supervisor.html" id="adminLink" style="display:none;">Supervisor Dashboard</a>
      <button onclick="logout()">Logout</button>
    </nav>
  </header>

  <main>
    <div class="filter-bar">
      <input type="text" id="search" placeholder="Search candidate by name..." onkeyup="filterCandidates()" />
      <select id="deptFilter" onchange="filterCandidates()">
        <option value="all">All Departments</option>
        <option value="CSE">CSE</option>
        <option value="EEE">EEE</option>
        <option value="BBA">BBA</option>
      </select>
    </div>

    <h2>Participants List</h2>
    <table id="candidateTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Department</th>
          <th>Email</th>
          <th>Registration Date</th>
          <th>Role</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        </tbody>
    </table>
  </main>

  <footer>
    <p>¬© 2025 <strong>CampusCast</strong> | Candidate Panel</p>
  </footer>

  <script>
    const CC_USERS_KEY = "cc_users";
    const CC_CURRENT_USER_KEY = "cc_currentUser";

    // 1. Check Access (Must be logged in as Admin, Supervisor, or Candidate)
    function checkAccess() {
      const currentUserData = localStorage.getItem(CC_CURRENT_USER_KEY);
      if (!currentUserData) {
        alert("Please login first.");
        window.location.href = "../login/login.html";
        return;
      }
      
      const user = JSON.parse(currentUserData);
      // Allowed roles: admin, supervisor, candidate
      const allowed = ['admin', 'supervisor', 'candidate'];
      
      if (!allowed.includes(user.role)) {
        alert("Access Denied. You do not have permission to view this page.");
        window.location.href = "../index.html"; 
      }

      // Show supervisor link only if admin/supervisor
      if(user.role === 'admin' || user.role === 'supervisor') {
        document.getElementById('adminLink').style.display = 'inline';
      }
    }

    // 2. Load Candidates from LocalStorage
    function loadCandidates() {
      const users = JSON.parse(localStorage.getItem(CC_USERS_KEY) || "[]");
      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = ""; // Clear existing

      // Filter only users who registered as 'candidate'
      const candidates = users.filter(u => u.role === 'candidate');

      if (candidates.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='5' style='text-align:center;'>No candidates registered yet.</td></tr>";
        return;
      }

      candidates.forEach(user => {
        // Assign a random department for demo purposes if not saved
        const dept = user.dept || "General"; 
        const date = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : "N/A";

        const row = `
          <tr data-dept="${dept}">
            <td>${user.name}</td>
            <td>${dept}</td>
            <td>${user.email}</td>
            <td>${date}</td>
            <td><span class="role-badge">Candidate</span></td>
          </tr>
        `;
        tableBody.insertAdjacentHTML('beforeend', row);
      });
    }

    // 3. Search/Filter Function
    function filterCandidates() {
      const search = document.getElementById("search").value.toLowerCase();
      const deptFilter = document.getElementById("deptFilter").value;
      const rows = document.querySelectorAll("#tableBody tr");

      rows.forEach(row => {
        if(row.children.length < 2) return; // Skip empty message row

        const name = row.children[0].textContent.toLowerCase();
        const dept = row.children[1].textContent;
        
        const matchesSearch = name.includes(search);
        const matchesDept = deptFilter === "all" || dept === deptFilter;

        row.style.display = (matchesSearch && matchesDept) ? "" : "none";
      });
    }

    function logout() {
      localStorage.removeItem(CC_CURRENT_USER_KEY);
      window.location.href = "../login/login.html";
    }

    // Initialize
    checkAccess();
    loadCandidates();
  </script>
</body>
</html>