<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶§‡ßà‡¶∞‡¶ø | Supervisor</title>
  <link rel="stylesheet" href="../assets/style.css" />
</head>

<body>
  <div class="hands-bg"></div>

  <div class="container">
    <!-- Header -->
    <header class="site-header">
      <a href="../index.html" class="logo" aria-label="CampusCast ‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú‡ßá ‡¶Ø‡¶æ‡¶®">
        <div class="logo-text">
          <span>CampusCast</span>
          <div class="logo-bars">
            <div class="bar"></div>
            <div class="bar alt"></div>
            <div class="bar"></div>
            <div class="bar alt"></div>
          </div>
        </div>
        <div class="logo-subtitle">‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡ßü ‡¶á ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</div>
      </a>

      <nav class="site-nav">
        <a href="supervisor.html" class="nav-link">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a>
       <!--<a href="totalelection.html" class="nav-link">‡¶∏‡¶ï‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</a>-->
        <a href="create_election.html" class="nav-link">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶§‡ßà‡¶∞‡¶ø</a>
        <a href="registeredcandidates.html" class="nav-link">‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ</a>
        <a href="registervoters.html" class="nav-link">‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞</a>
        <button class="login-btn" type="button" onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
      </nav>
    </header>

    <main class="main-content" style="flex-direction:column; gap:30px;">
      <section class="content" style="max-width:600px;">
        <span class="badge">‡¶∏‡ßÅ‡¶™‡¶æ‡¶∞‡¶≠‡¶æ‡¶á‡¶ú‡¶æ‡¶∞</span>
        <h1>‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶§‡ßà‡¶∞‡¶ø</h1>
        <p class="description" style="margin-bottom:12px;">
          ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶è‡¶á ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
        </p>
        <p id="status" style="font-size:14px;"></p>
      </section>

      <section style="max-width:600px; width:100%;">
        <div style="
          background:#fff;
          padding:20px;
          border-radius:14px;
          border:1px solid var(--border);
          box-shadow:0 6px 18px rgba(0,0,0,.08);
        ">
          <form id="createElectionForm">
            <div class="form-group" style="margin-bottom:12px;">
              <label style="font-weight:700; margin-bottom:6px; display:block;">
                ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ
              </label>
              <input
                type="text"
                id="title"
                required
                placeholder="‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: ‡ß®‡ß¶‡ß®‡ß´ ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶æ‡¶≤ ‡¶á‡¶â‡¶®‡¶ø‡ßü‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®"
                style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border);"
              />
            </div>

            <div class="form-group" style="margin-bottom:12px;">
              <label style="font-weight:700; margin-bottom:6px; display:block;">
                ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)
              </label>
              <textarea
                id="description"
                rows="3"
                placeholder="‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"
                style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border); resize:vertical;"
              ></textarea>
            </div>

            <div class="form-group" style="margin-bottom:12px;">
              <label style="font-weight:700; margin-bottom:6px; display:block;">
                ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶∏‡¶Æ‡ßü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)
              </label>
              <input
                type="datetime-local"
                id="start_at"
                style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border);"
              />
            </div>

            <div class="form-group" style="margin-bottom:16px;">
              <label style="font-weight:700; margin-bottom:6px; display:block;">
                ‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Æ‡ßü (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)
              </label>
              <input
                type="datetime-local"
                id="end_at"
                style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border);"
              />
            </div>

            <button type="submit" class="btn btn-primary" style="width:100%;">
              ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
          </form>
        </div>
      </section>
    </main>

    <footer class="features">
      <div class="feature">
        <div class="feature-icon">üßæ</div>
        <div class="feature-text">
          <h3>‡¶∏‡ßç‡¶¨‡¶ö‡ßç‡¶õ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ</h3>
          <p>‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶ì ‡¶®‡¶ø‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡•§</p>
        </div>
      </div>
      <div class="feature">
        <div class="feature-icon">üîí</div>
        <div class="feature-text">
          <h3>‡¶è‡¶®‡ßç‡¶° ‡¶ü‡ßÅ ‡¶è‡¶®‡ßç‡¶° ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡¶∂‡¶®</h3>
          <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ß‡¶æ‡¶™‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡ßá‡•§</p>
        </div>
      </div>
      <div class="feature">
        <div class="feature-icon">‚ö°</div>
        <div class="feature-text">
          <h3>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶ì ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞</h3>
          <p>‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
        </div>
      </div>

      <div class="nav-arrows">
        <button class="arrow-btn" aria-label="‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°">‚Äπ</button>
        <button class="arrow-btn" aria-label="‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°">‚Ä∫</button>
      </div>

      <div class="dots" aria-hidden="true">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>

      <div class="footer-credit">
        <p>¬© ‡ß®‡ß¶‡ß®‡ß´ <strong>FourA</strong> ‚Äì CampusCast</p>
      </div>
    </footer>
  </div>

  <!-- Supabase UMD bundle -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script>
    const SUPABASE_URL = "https://hgxjuxgxgbjjqxxvafhx.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_RqoNSHsQQOhs8dfL0OXsdA_TfeVyZcn";

    // Important: use window.supabase here
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const CC_CURRENT_USER_KEY = "cc_currentUser";

    function getCurrentUser() {
      try {
        const raw = localStorage.getItem(CC_CURRENT_USER_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      } catch {
        return null;
      }
    }

    function logout() {
      localStorage.removeItem(CC_CURRENT_USER_KEY);
      window.location.href = "../index.html";
    }

    const form = document.getElementById("createElectionForm");
    const statusEl = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.style.color = "crimson";
      statusEl.textContent = "‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

      const user = getCurrentUser();
      if (!user || user.role !== "supervisor") {
        statusEl.textContent = "‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ Supervisor ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§";
        return;
      }

      const title = document.getElementById("title").value.trim();
      const description = document.getElementById("description").value.trim();
      const start_at = document.getElementById("start_at").value || null;
      const end_at = document.getElementById("end_at").value || null;

      if (!title) {
        statusEl.textContent = "‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§";
        return;
      }

      const { error } = await supabase
        .from("elections")
        .insert([
          {
            title,
            description,
            start_at,
            end_at,
            status: "scheduled",
            created_by: user.id
          }
        ]);

      if (error) {
        console.error("Create election error:", error);
        statusEl.style.color = "crimson";
        statusEl.textContent = "‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
        return;
      }

      statusEl.style.color = "green";
      statusEl.textContent = "‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§";
      form.reset();
    });
  </script>
</body>
</html>
